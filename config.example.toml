# Example configuration for Akkoproxy
# Copy this file to config.toml and adjust the settings

[upstream]
# Upstream Akkoma/Pleroma server URL (required)
url = "https://akkoma.example.com"

# Timeout for upstream requests in seconds (default: 30)
timeout = 30

[server]
# Address to bind the server to (default: 0.0.0.0:3000)
bind = "0.0.0.0:3000"

# Custom Via header value (default: akkoproxy/{version})
via_header = "akkoproxy/0.1.0"

# Preserve all headers from upstream when responding (default: true)
preserve_upstream_headers = true

# Enable Cloudflare Free plan compatibility mode (default: false)
# When enabled, the proxy will look for a 'format' query parameter to determine
# output format (avif/webp), then strip it from the upstream request.
# This is useful with Cloudflare's Transform Rules to add format based on Accept header.
# Example Cloudflare Transform Rule:
#   - If: Accept header contains "image/avif"
#   - Then: Add query parameter "format=avif"
behind_cloudflare_free = false

[cache]
# Maximum number of cached items (default: 10000)
max_capacity = 10000

# Time to live for cached items in seconds (default: 3600)
ttl = 3600

# Maximum size of a cached item in bytes (default: 10485760, 10MB)
max_item_size = 10485760

[image]
# Enable AVIF conversion (default: true)
enable_avif = true

# Enable WebP conversion (default: true)
enable_webp = true

# JPEG quality for conversions, 1-100 (default: 85)
quality = 85

# Maximum image dimensions for processing (default: 4096)
max_dimension = 4096
